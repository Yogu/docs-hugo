{{- $currentPage := .}}
{{- $curPosition := 0 }}
{{- $nextIndex := 0 }}
{{- $prevIndex := 0 }}
{{- $prev := "" }}
{{- $next := ""}}

{{- $pages := .CurrentSection.Pages }}

{{- range $pages }}
  {{- if eq $currentPage . }}
    {{- $nextIndex = add $curPosition 1 }}

    {{- if and (eq $curPosition 0) (not $currentPage.IsSection) }}
      {{ $prev = .Parent }}
    {{- else }}
      {{- $prevIndex = sub $curPosition 1 }}
      {{- $prev = index $pages $prevIndex }}
    {{- end }}
  {{- else }}
    {{- $curPosition = add $curPosition 1 }}
  {{- end }}
{{- end }}
{{- $next = index $pages $nextIndex }}

{{- if not $next }}
  {{- $curPosition = 0 }}
  {{- $parent := $currentPage.Parent }}
  {{- with $parent.Parent }}
  {{- $pages = $parent.Parent.Pages}}
  {{- range $pages }}
    {{- if eq $parent . }}
      {{- $nextIndex = add $curPosition 1 }}
      {{- $next = index $pages $nextIndex }}
    {{- else }}
      {{- $curPosition = add $curPosition 1 }}
    {{- end }}
  {{- end }}
  {{- end }}
{{- end }}

{{- if $currentPage.IsSection }}
  {{- $curPosition = 0 }}
  {{- $pages = $currentPage.Parent.Pages }}

  {{- range $pages }}
    {{- if eq $currentPage . }}
      {{- if eq $curPosition 0 }}
        {{- $prev = .Parent }}
      {{- else }}
        {{- $prevIndex = sub $curPosition 1 }}
        {{- $prev = index $pages $prevIndex }}

      {{- end }}
    {{- else }}
      {{- $curPosition = add $curPosition 1 }}
    {{- end }}
  {{- end }}
{{- end }}

<nav class="pagination">
{{- with $prev }}
  <a rel="previous" href="{{ .RelPermalink }}" title="{{ .Params.menuTitle }}">
      &lt; {{.Params.menuTitle | markdownify}}
  </a>
{{- end }}
{{- with $next }}
  <a rel="next" href="{{ .RelPermalink }}" title="{{ .Params.menuTitle }}">
    {{.Params.menuTitle | markdownify}} &gt;
  </a>
{{- end }}
</nav>
