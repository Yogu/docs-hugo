{{- $disabled := page.Params.pageToc.disabled | default false }}
{{- if and (not $disabled) (.Page.Fragments.HeadingsMap | len) 2 }}
{{/* TODO: Use of aside (inside main), aria role, schema.org */}}
<aside>
  <nav class="toc">
    <div class="toc-header">On this page</div>
      {{ template "nestedHeadline" dict "headings" .Page.Fragments.Headings "level" 1 }}
    </div>
  </nav>
</aside>
{{- end }}

{{- define "nestedHeadline" }}
{{- $headings := .headings }}
{{- $level := .level | default 1 }}
{{- $maxLevel := page.Params.pageToc.maxHeadlineLevel | default 5 }}
{{- if le $level $maxLevel }}
<ul>
  {{- range $h := $headings }}
    {{- with $h.Title }}<li><a href="#{{ $h.ID }}">{{ $h.Title | markdownify }}</a></li>{{ end }}
    {{- template "nestedHeadline" dict "headings" $h.Headings "level" (add $level 1) }}
  {{- end }}
</ul>
{{- end }}
{{- end }}
